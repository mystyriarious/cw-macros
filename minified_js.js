// Content Warning Macro by Mistyrious
// Last tested Sugarcube 2.36.1, March 24 2024
var sens_topics=[],warning_uppercase=!1;Macro.add("cwList",{handler:function(){if(this.args.length>2)return this.error("Too many arguments! Make sure all content warnings are in the first argument separated by spaces, and the second argument is only true or false");if(0==this.args.length)return this.error('Please specify the variables pertaining to each trigger in quotes, separated by a space. For example: "violence death"');var content_warnings=this.args[0].split(" ");for(let i=0;i<content_warnings.length;i++){var trigger=content_warnings[i],state_var=eval("State.variables."+trigger);if(void 0===state_var)return this.error("One of the content warnings is not associated with a variable! Please fix so that each warning is the same name as the variable that is being set for each trigger");state_var?sens_topics.includes(trigger)||sens_topics.push(trigger):sens_topics.includes(trigger)&&sens_topics.splice(sens_topics.indexOf(trigger),1)}this.args.length>1&&!0==this.args[1]&&(warning_uppercase=!0)}}),Macro.add("warn",{handler:function(){if(this.args.length<2)return this.error("Need to specify ID and warnings!");let e=this.args[0];var s=this.args[1].split(" "),t=[];if(this.args.length>2){var r=this.args[2].split(", ");if(r.length>s.length)return this.error("Specified too many warning names");if(r.length<s.length)return this.error("Specified too little warning names; make sure the warning names are in the same order as the warnings you specified")}var a=[];for(let n=0;n<s.length;n++)for(let i=0;i<sens_topics.length;i++)s[n]!=sens_topics[i]||(t.push(s[n]),void 0===r||a.includes(r[n])||a.push(r[n]));if(this.args.length<=2&&!0==warning_uppercase&&t.length>0){var h=t[0].charAt(0).toUpperCase();t[0]=h+t[0].slice(1)}var l=t.join(", ");this.args.length>2&&a.length>0&&(h=a[0].charAt(0).toUpperCase(),a[0]=h+a[0].slice(1),l=a.join(", ")),$(document).one(":passagedisplay",function(s){var r=document.getElementById(e),a=r.innerHTML;t.length>0&&$(r).wiki("<<replace '#"+e+"'>><<linkreplace '<b>CW:</b> "+l+"' t8n>>"+a+"<</linkreplace>><</replace>>")})}});
